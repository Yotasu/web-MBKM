<!DOCTYPE html>
<html>

<head>
    <title>Edit Data Mahasiswa</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
<div class="container">
    <h2 class="mt-3">Edit Data Mahasiswa</h2>
    <form id="editForm" method="put" enctype="multipart/form-data">
        <input type="hidden" id="id" name="id"> <!-- Menambahkan input tersembunyi untuk menyimpan ID -->

        <div class="form-group">
            <label for="buktiPendukung">Bukti Pendukung:</label>
            <input type="file" id="buktiPendukung" name="buktiPendukung" class="form-control-file" required>
        </div>

        <div class="form-group">
            <label for="inputKonversi">Input Konversi:</label>
            <input type="text" id="inputKonversi" name="inputKonversi" class="form-control" required>
        </div>

        <div class="form-group">
            <label for="namaMahasiswa">Nama Mahasiswa:</label>
            <select id="namaMahasiswa" name="namaMahasiswa" class="form-control" required><!-- Option elements will be populated dynamically --></select>
        </div>

        <button type="button" class="btn btn-primary" onclick="updateData()">Perbarui</button>

    </form>
</div>

<script src="edit_per.js"></script>

<script>
    // Fungsi untuk mengisi formulir dengan data yang diterima dari parameter URL
    function fillForm() {
        var urlParams = new URLSearchParams(window.location.search);
        var id = urlParams.get('id');
        document.getElementById('id').value = id; // Mengisi input tersembunyi dengan ID

        // Lakukan permintaan HTTP untuk mengambil data berdasarkan ID
        var url = 'http://localhost:8085/persetujuanMbkm/find-by-id/' + id;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                document.getElementById('inputKonversi').value = data.inputKonversi;
                document.getElementById('namaMahasiswa').value = data.regMbkmId;
            })
            .catch(error => console.error('Error:', error));
    }

    // Fungsi untuk mengirim data perubahan ke server
    function updateData() {
        var form = document.getElementById('editForm');
        var formData = new FormData(form);

        // Mengambil nilai regMbkmId dari dropdown
        var selectedNamaMahasiswa = document.getElementById('namaMahasiswa');
        var selectedOption = selectedNamaMahasiswa.options[selectedNamaMahasiswa.selectedIndex];
        formData.set('regMbkmId', selectedOption.value);

        var id = document.getElementById('id').value;

        // Send a POST request to update data by ID
        var updateUrl = 'http://localhost:8085/persetujuanMbkm/update/' + id;

        fetch(updateUrl, {
            method: 'PUT',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // Handle the response data, you can show a success message or redirect to another page
            alert('Data has been updated successfully');
            window.location.href = 'per_view.html'; // Redirect to the list of students page
        })
        .catch(error => console.error('Error:', error));
    }

    // Call the fillForm function when the page loads to populate the form with data
    fillForm();
    // Populate the dropdown when the page loads
    window.onload = populateNamaMahasiswa;
</script>

</body>

</html>
