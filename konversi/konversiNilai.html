<!DOCTYPE html>
<html>

<head>
    <title>Konversi Nilai MBKM</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
    <div class="container">
        <h2 class="mt-3">Form Konversi Nilai MBKM</h2>
        <form id="konversiForm" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="bukPen">Bukti Pendukung:</label>
                <input type="file" id="bukPen" name="bukPen" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="laporanKegiatan">Laporan Kegiatan:</label>
                <input type="file" id="laporanKegiatan" name="laporanKegiatan" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="konversi">Input Konversi:</label>
                <input type="text" id="konversi" name="konversi" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="inputKonversi">Mata Kuliah:</label>
                <select id="inputKonversi" name="inputKonversi" class="form-control" required>
                    <!-- Option elements will be populated dynamically based on the data from the server -->
                </select>
            </div>

            <button type="button" class="btn btn-primary" onclick="submitForm()">Submit</button>
        </form>
    </div>

    <script>
        // Function to populate the dropdown with inputKonversi from persetujuanMbkm
        function populateInputKonversi() {
            // Send a request to the server to get the inputKonversi from persetujuanMbkm
            fetch('http://localhost:8085/persetujuanMbkm/findAll') // Gunakan endpoint yang sesuai
                .then(response => response.json())
                .then(data => {
                    var inputKonversiSelect = document.getElementById('inputKonversi');

                    // Loop through the data and add options to the dropdown
                    data.forEach(function(persetujuanMbkm) {
                        var option = document.createElement('option');
                        option.value = persetujuanMbkm.persetujuanMbkmId; // Set the value as the inputKonversi
                        option.text = persetujuanMbkm.inputKonversi;
                        inputKonversiSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function submitForm() {
            var form = document.getElementById('konversiForm');
            var formData = new FormData(form);

            var selectedInputkonversi = document.getElementById('inputKonversi');
            var selectedOption = selectedInputkonversi.options[selectedInputkonversi.selectedIndex];
            formData.set('persetujuanMbkmId', selectedOption.value);

            // Send a POST request to the API endpoint
            fetch('http://localhost:8085/KonversiNilai/create', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                alert('Data has been created successfully');
                window.location.href = 'konversi_view.html';
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        // Populate the dropdown when the page loads
        window.onload = populateInputKonversi;
    </script>

</body>
</html>
