<!DOCTYPE html>
<html>

<head>
    <title>Dosen Pembimbing Lapangan</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
    <div class="container">
        <h2 class="mt-3">Dosen Pembimbing Lapangan</h2>
        <!-- Form untuk menambahkan entri logbook -->
        <form id="dplForm" method="post" enctype="multipart/form-data">

            <div class="form-group">
                <label for="nama">Nama Dosen:</label>
                <select id="nama" name="nama" class="form-control" required><!-- Option elements will be populated dynamically --></select>
            </div>

            <div class="form-group">
                <label for="namaMahasiswa">Mahasiswa:</label>
                <select id="namaMahasiswa" name="namaMahasiswa" class="form-control" required></select>
            </div>

            <button type="button" class="btn btn-primary" onclick="submitForm()">Tambahkan</button>
        </form>

    </div>

    <script>
        // Function to populate the dropdown with names of students
        function populateNamaDosen() {
            // Mengambil data nama dosen dari server menggunakan endpoint findAll
            fetch('http://localhost:8085/dosen/find-all') // Ganti URL dengan endpoint findAll
                .then(response => response.json())
                .then(data => {
                    var namaDosenSelect = document.getElementById('nama');

                    // Loop melalui data dan tambahkan opsi ke dropdown
                    data.forEach(function (dosen) {
                        var option = document.createElement('option');
                        option.value = dosen.nik; // Anda mungkin perlu mengganti ini sesuai dengan data yang diterima dari server
                        option.text = dosen.nama;
                        namaDosenSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function submitForm() {
            var form = document.getElementById('dplForm');
            var formData = new FormData(form);

            // Get the selected student's name and set it as regMbkmId
            var selectedNamaMahasiswa = document.getElementById('namaMahasiswa');
            var selectedOption = selectedNamaMahasiswa.options[selectedNamaMahasiswa.selectedIndex];
            formData.set('regMbkmId', selectedOption.value || ''); // Set regMbkmId as the selected student's value, handle null

            // Get the selected dosen's nik and set it as nik
            var selectedNamaDosen = document.getElementById('nama');
            var selectedOptions = selectedNamaDosen.options[selectedNamaDosen.selectedIndex];
            formData.set('nik', selectedOptions.value || ''); // Set nik as the selected dosen's value, handle null

            // Send a POST request to the API endpoint
            var url = 'http://localhost:8085/dpl/create';

            fetch(url, {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    alert('Data has been created successfully');
                    window.location.href = 'dpl_view.html';
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        // Panggil fungsi-fungsi yang diperlukan pada saat halaman dimuat
        window.onload = function () {
            populateNamaDosen();
            populateNamaMahasiswa(); // Pastikan fungsi ini ada dan mengambil data dengan benar
        };
    </script>

    <script src="dplMahasiswa.js"></script>

</body>

</html>
